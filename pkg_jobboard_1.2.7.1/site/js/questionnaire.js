
/**
  @package JobBoard
  @copyright Copyright (c)2010-2013 Figomago <http://figomago.wordpress.com>
  @license : GNU General Public License v3 or later
----------------------------------------------------------------------- */

var edPaneSlide,QuestionnaireJson,editInputs,fieldLbl,fieldName,fnameTxt,fieldType,fieldNameVal,fieldDefaultVal,actionEls,defaultsPane,contQ,addBtn,qSorter,newFieldDefaults,submitBtn,windowScroll;var QuestionnaireData={};window.addEvent("domready",function(){defaultsPane=$("ed_extra");contQ=$("fpanel");submitBtn=$("save_frm");editInputs=$("jbcontent").getElement("div[class=qedwrapper]");qSorter=new Sortables(contQ,{opacity:0.3,constrain:true,transition:Fx.Transitions.Elastic.easeOut,duration:450,revert:{duration:450,transition:"elastic:out"},onComplete:recalcElements});recalcElements();setDelActns();setActionElements();$("title_0").addEvents({focus:function(){document.qForm.elements.title.value=this.value;document.qForm.elements.name.value=cleanString(this.value)},blur:function(){document.qForm.elements.title.value=this.value;document.qForm.elements.name.value=cleanString(this.value)},keyup:function(){document.qForm.elements.title.value=this.value;document.qForm.elements.name.value=cleanString(this.value)}});$("description_0").addEvents({focus:function(){document.qForm.elements.description.value=this.value},blur:function(){document.qForm.elements.description.value=this.value},keyup:function(){document.qForm.elements.description.value=this.value}});if($("field_add")){addBtn=$("field_add");fieldLbl=editInputs.getElement("input[id=field_label]");fieldName=editInputs.getElement("input[id=field_name]");fnameTxt=editInputs.getElement("span[id=fnametxt]");fieldType=editInputs.getElement("select[id=field_type]");fieldNameVal;windowScroll=new Fx.Scroll(window,{transition:Fx.Transitions.Pow.easeInOut});edPaneSlide=new Fx.Slide("ed_extra",{duration:450,transition:Fx.Transitions.Pow.easeOut}).slideIn();var a=fieldType.value;setEditPane(defaultsPane,a);fieldLbl.addEvent("keyup",function(){fieldNameVal=cleanString(this.value);fieldName.setAttribute("value",fieldNameVal);fnameTxt.set("text",fieldNameVal)});addBtn.addEvent("click",function(f){f=new Event(f).stop();if(fieldLbl.value!=""){var b=$$("div.qrow");var c=b.length;var d=c>0?c-1:0;var k=fieldLbl.value;fieldNameVal=fieldName.value;var j=fieldType.value;var g=defaultsPane.getLast().getLast();var i=g.tagName.toLowerCase();fieldDefaultVal=newFieldDefaults.deflt;var h={name:fieldNameVal,label:k,deflt:fieldDefaultVal,type:j,restricted:newFieldDefaults.restricted};addRow(h,d)}});fieldType.addEvent("change",function(c){c=new Event(c).stop();var b=fieldType.value;setEditPane(defaultsPane,b);windowScroll.toElement("newfheader","y")})}});var cleanString=function(b){var a=b.toLowerCase().trim();a=a.replace(/[^a-zA-Z0-9]+/gi,function(c){return replaceSpace(c)});a=a.length>21?a.substr(0,21):a;return a};var setActionElements=function(){$$("a.ed").each(function(a){a.addEvents({click:function(b){b=new Event(b).stop();actionEls={};if(qSorter!=null){qSorter.detach()}qSorter=null;submitBtn.setAttribute("disabled",true);actionEls.edDiv=this.getParent("div.qrow");actionEls.rowLbl=actionEls.edDiv.getFirst("label");actionEls.restricted=actionEls.rowLbl.hasClass("restricted")?1:0;edPaneSlide.slideOut("vertical");editInputs.addClass("opacityPointFour");editInputs.getElements("input").each(function(c){c.setAttribute("disabled",true)});editInputs.getElements("select").each(function(c){c.setAttribute("disabled",true)});actionEls.edDiv.addClass("qrowed");contQ.getElements("div.qrow").each(function(c){c.addClass("qrowedmode")});actionEls.rowNme=actionEls.rowLbl.getAttribute("for");actionEls.rowTxt=actionEls.rowLbl.get("text");actionEls.rowField=actionEls.edDiv.getLast();actionEls.FieldTag=actionEls.rowField.tagName.toLowerCase();if(actionEls.FieldTag=="span"||actionEls.FieldTag=="select"){}else{actionEls.descrSpan=new Element("span",{text:jbVars.defVal}).setStyles({"float":"right","margin-top":"15px","margin-right":"10px",display:"inline-block","font-size":"11px"}).injectAfter(actionEls.rowField)}switch(actionEls.FieldTag){case"input":actionEls.rowField.removeAttribute("disabled");break;case"select":actionEls.rowField.removeAttribute("disabled");actionEls.opts=actionEls.rowField.getElements("option");actionEls.defaultOpt=actionEls.rowField.value;actionEls.selVal=actionEls.defaultOpt;actionEls.selOpt=actionEls.rowField.getElement("option[value="+actionEls.selVal+"]");actionEls.rowInput=new Element("input",{size:15,"class":"right",type:"text",name:actionEls.rowField.getAttribute("name"),value:actionEls.selOpt.text}).addEvents({keyup:function(d){d=new Event(d).stop();actionEls.selOpt=actionEls.rowField.getElement("option[value="+actionEls.rowField.value+"]");actionEls.selOpt.text=this.value},blur:function(d){d=new Event(d).stop();actionEls.selOpt=actionEls.rowField.getElement("option[value="+actionEls.rowField.value+"]");actionEls.selOpt.text=this.value}}).setStyles({padding:"1px","font-size":"11px"}).injectBefore(actionEls.rowField);actionEls.rowDefltBtn=new Element("span",{"class":"sdefault",text:" "}).addClass("selected").addClass("right").addEvent("click",function(c){c=new Event(c).stop();actionEls.opts.each(function(d){d.removeAttribute("selected")});actionEls.selVal=actionEls.rowField.value;actionEls.selOpt=actionEls.rowField.getElement("option[value="+actionEls.selVal+"]");actionEls.selOpt.setAttribute("selected","selected");actionEls.rowDefltBtn.addClass("selected")}).injectAfter(actionEls.rowInput);actionEls.rowAddCirc=new Element("span",{"class":"add",text:" "}).addClass("right").addEvent("click",function(c){c=new Event(c).stop();actionEls.opts=actionEls.rowField.getElements("option");actionEls.lastOpt=actionEls.rowField.getLast("option");actionEls.nextOpt=parseInt(actionEls.lastOpt.value)+1;actionEls.lastOpt=new Element("option",{value:actionEls.nextOpt,text:jbVars.txtOption+" "+actionEls.nextOpt}).injectInside(actionEls.rowField);actionEls.rowField.selectedIndex=actionEls.nextOpt-1;actionEls.rowInput.value=actionEls.lastOpt.text;actionEls.rowDefltBtn.removeClass("selected")}).injectBefore(actionEls.rowInput);actionEls.rowDelCirc=new Element("span",{"class":"cremove",text:" "}).addClass("right").addEvent("click",function(c){c=new Event(c).stop();actionEls.selVal=actionEls.rowField.value;actionEls.opts=actionEls.rowField.getElements("option");actionEls.selOpt=actionEls.rowField.getElement("option[value="+actionEls.selVal+"]");if(actionEls.opts.length<2){return false}actionEls.changeDefault=actionEls.defaultOpt==actionEls.selVal?true:false;actionEls.selOpt.removeEvents().destroy();actionEls.opts=actionEls.rowField.getElements("option");actionEls.opts[0].setAttribute("selected","selected");actionEls.selVal=actionEls.rowField.value;actionEls.selOpt=actionEls.rowField.getElement("option[value="+actionEls.selVal+"]");actionEls.rowInput.value=actionEls.selOpt.text;if(actionEls.changeDefault==true){actionEls.rowDefltBtn.addClass("selected");actionEls.defaultOpt=actionEls.selVal}else{if(actionEls.defaultOpt==actionEls.selVal){actionEls.rowDefltBtn.addClass("selected")}else{actionEls.rowDefltBtn.removeClass("selected")}}}).injectBefore(actionEls.rowAddCirc);actionEls.rowField.addEvent("change",function(c){c=new Event(c).stop();actionEls.selVal=actionEls.rowField.value;actionEls.selOpt=actionEls.rowField.getElement("option[value="+actionEls.selVal+"]");actionEls.rowInput.value=actionEls.selOpt.text;if(actionEls.defaultOpt==actionEls.selVal){actionEls.rowDefltBtn.addClass("selected")}else{actionEls.rowDefltBtn.removeClass("selected")}});break;case"textarea":actionEls.rowField.removeAttribute("disabled");break;case"span":if(actionEls.rowField.hasClass("checkbox")){actionEls.rowInput=actionEls.rowField.getParent("div.qrow").getElement("input[type=checkbox]");actionEls.rowInput.removeAttribute("disabled");actionEls.rowInput.addClass("m2em");actionEls.rowInput.addEvent("click",(function(){if(!this.getAttribute("checked")){this.setAttribute("checked","checked")}else{this.removeAttribute("checked")}}));actionEls.rowLblTxt=actionEls.rowField.get("text");actionEls.rowField.setStyle("display","none");actionEls.rowInputLabel=new Element("input",{size:15,"class":"right",name:"cb_label_val",type:"text",value:actionEls.rowLblTxt}).setStyles({padding:"1px","font-size":"11px"}).injectAfter(actionEls.rowInput);actionEls.rowLblTxt=null}if(actionEls.rowField.hasClass("radios")){actionEls.rowField.addClass("r5px");actionEls.rowLabels=[];actionEls.rowInputs=[];actionEls.rowFields=actionEls.rowField.getElements("input[type=radio]");actionEls.rowFields.each(function(d){var e=d.getAttribute("value");d.removeAttribute("disabled");var c=d.getParent("span.radio").getElement("label");actionEls.rowLabels[e]=c.get("text");actionEls.rowInputs[e]=new Element("input",{size:15,"class":"left",type:"text",name:d.getAttribute("name")+"_"+e,value:actionEls.rowLabels[e]}).setStyles({padding:"1px","font-size":"11px"}).injectBefore(d);c.destroy();d.addEvent("click",function(){actionEls.rowFields.each(function(f){f.removeAttribute("defaultchecked");f.removeAttribute("checked")});this.setAttribute("checked","checked")})});actionEls.rowHeight=parseInt(actionEls.edDiv.getStyle("height").replace("px",""));actionEls.radioHeight=parseInt(actionEls.rowFields[0].getParent("span.radio").getStyle("height").replace("px",""));actionEls.currRowSlide=new Fx.Slide(actionEls.edDiv.id,{duration:350,transition:Fx.Transitions.Pow.easeOut}).slideIn("vertical");actionEls.rowAddCirc=new Element("span",{"class":"add",text:" "}).addClass("right").addEvent("click",function(c){c=new Event(c).stop();actionEls.rowFields=actionEls.rowField.getElements("input[type=radio]");actionEls.rowFields.each(function(d){d.removeAttribute("defaultchecked");d.removeAttribute("checked")});actionEls.lastRadio=actionEls.rowFields.getLast();actionEls.nextOpt=parseInt(actionEls.lastRadio.value)+1;actionEls.nextTxt=jbVars.txtOption+" "+actionEls.nextOpt;actionEls.newRadioLbl=actionEls.nextTxt;actionEls.newRadioName=cleanString(actionEls.nextTxt);actionEls.newRadioSpan=new Element("span",{"class":"radio"});actionEls.newRadioOpt=new Element("input",{type:"radio","class":"right",name:actionEls.lastRadio.name,id:actionEls.newRadioName,alt:actionEls.newRadioLbl,value:actionEls.nextOpt}).addEvent("click",function(){actionEls.rowFields=actionEls.rowField.getElements("input[type=radio]");actionEls.rowFields.each(function(d){d.removeAttribute("defaultchecked");d.removeAttribute("checked")});this.setAttribute("checked","checked")}).injectInside(actionEls.newRadioSpan);actionEls.rowFields.each(function(d){d.removeAttribute("defaultchecked");d.removeAttribute("checked")});actionEls.newRadioOpt.setAttribute("checked","checked");actionEls.newRadioOptLbl=new Element("input",{size:15,"class":"left",type:"text",name:actionEls.lastRadio.name+"_"+actionEls.nextOpt,value:actionEls.newRadioLbl}).setStyles({padding:"1px","font-size":"11px"}).injectBefore(actionEls.newRadioOpt);actionEls.rowHeight+=actionEls.radioHeight;actionEls.edDiv.setStyle("height",actionEls.rowHeight+"px");actionEls.currRowSlide.slideIn("vertical").chain(function(){actionEls.newRadioSpan.injectInside(actionEls.rowField)})}).injectBefore(actionEls.rowField);actionEls.rowDelCirc=new Element("span",{"class":"cremove",text:" "}).addClass("right").addEvent("click",function(c){c=new Event(c).stop();actionEls.rowFields=actionEls.rowField.getElements("input[type=radio]");if(actionEls.rowFields.length<2){return false}actionEls.rowFields.each(function(d){if(d.getAttribute("checked")!=null||d.getAttribute("defaultchecked")!=null){actionEls.deleteRadio=d.getParent("span.radio")}});actionEls.rowHeight-=actionEls.radioHeight;actionEls.edDiv.setStyle("height",actionEls.rowHeight+"px");actionEls.deleteRadio.setStyle("opacity",0).removeEvents().destroy();actionEls.currRowSlide.slideIn("vertical");actionEls.rowFields=actionEls.rowField.getElements("input[type=radio]");actionEls.rowFields[0].setAttribute("checked","checked")}).injectBefore(actionEls.rowAddCirc)}if(actionEls.rowField.hasClass("datelbl")){actionEls.dateInputs=actionEls.edDiv.getElements("input[type=text]");actionEls.dateRowMonth=actionEls.edDiv.getElement("select");actionEls.dateLbl=actionEls.dateRowMonth.name.replace("[month]","").trim();actionEls.dateRowDay=actionEls.dateInputs[1];actionEls.dateRowYr=actionEls.dateInputs[0];actionEls.showDay=actionEls.dateRowDay.hasClass("displnone")?0:1;actionEls.showMonth=actionEls.dateRowMonth.hasClass("displnone")?0:1;actionEls.dateFieldLbls=actionEls.edDiv.getElements("span.datelbl");actionEls.dateRowDay.addEvents({keypress:function(c){if((c.code==8||c.code==46)){}else{if(c.code<48||c.code>57||this.value.length>=2){c=new Event(c).stop()}}}});actionEls.dateRowYr.addEvents({keypress:function(c){if((c.code==8||c.code==46)){}else{if(c.code<48||c.code>57||this.value.length>=4){c=new Event(c).stop()}}}});actionEls.dateRowMonth.removeAttribute("disabled");actionEls.dateRowDay.removeAttribute("disabled");actionEls.dateRowYr.removeAttribute("disabled");actionEls.dateRowDayCb=new Element("input",{"class":"subinput",type:"checkbox",name:actionEls.dateLbl+"_show_d",value:"yes"}).addEvent("click",function(){if(actionEls.showDay==0){actionEls.showDay=1;actionEls.dateRowDay.removeAttribute("disabled");actionEls.dateRowDayCb.setAttribute("checked","checked");if(!actionEls.dateRowMonthCb.hasAttribute("checked")){actionEls.dateRowMonthCb.setAttribute("checked","checked");actionEls.dateRowMonthCb.checked=true;actionEls.dateRowMonth.removeAttribute("disabled");actionEls.showMonth=1}}else{actionEls.showDay=0;actionEls.dateRowDay.setAttribute("disabled","disabled");actionEls.dateRowDayCb.removeAttribute("checked")}}).injectAfter(actionEls.dateFieldLbls[1]);if(actionEls.showDay==1){actionEls.dateRowDayCb.setAttribute("checked","checked")}actionEls.dateRowMonthCb=new Element("input",{"class":"subinput",type:"checkbox",name:actionEls.dateLbl+"_show_m",value:"yes"}).addEvent("click",function(){if(actionEls.showMonth==0){actionEls.showMonth=1;actionEls.dateRowMonth.removeAttribute("disabled");actionEls.dateRowMonthCb.setAttribute("checked","checked");if(!actionEls.dateRowDayCb.hasAttribute("checked")){actionEls.dateRowDayCb.setAttribute("checked","checked");actionEls.dateRowDayCb.checked=true;actionEls.dateRowDay.removeAttribute("disabled");actionEls.showDay=1}}else{actionEls.showMonth=0;actionEls.dateRowMonth.setAttribute("disabled","disabled");actionEls.dateRowMonthCb.removeAttribute("checked");if(actionEls.dateRowDayCb.hasAttribute("checked")){actionEls.dateRowDayCb.removeAttribute("checked");actionEls.dateRowDayCb.checked=false;actionEls.dateRowDay.setAttribute("disabled","disabled");actionEls.showDay=0}}}).injectAfter(actionEls.dateFieldLbls[0]);if(actionEls.showMonth==1){actionEls.dateRowMonthCb.setAttribute("checked","checked")}if(actionEls.dateRowDay.hasClass("displnone")){actionEls.dateRowDay.removeClass("displnone")}if(actionEls.dateFieldLbls[2].hasClass("displnone")){actionEls.dateFieldLbls[2].removeClass("displnone")}if(actionEls.dateRowMonth.hasClass("displnone")){actionEls.dateRowMonth.removeClass("displnone")}if(actionEls.dateFieldLbls[1].hasClass("displnone")){actionEls.dateFieldLbls[1].removeClass("displnone")}if(actionEls.showDay==0){actionEls.dateRowDay.setAttribute("disabled","disabled");actionEls.dateRowDayCb.removeAttribute("checked")}if(actionEls.showMonth==0){actionEls.dateRowMonth.setAttribute("disabled","disabled");actionEls.dateRowMonthCb.removeAttribute("checked")}}break}actionElsRowActnbtns=contQ.getElements("div.qrow");actionElsRowActnbtns.each(function(c){if(c.id==actionEls.edDiv.id){c.getElements("a").each(function(d){d.setStyle("display","none")})}else{c.getElements("a").each(function(d){d.setStyle("visibility","hidden")})}});actionEls.lblInp=new Element("input",{size:40,"class":"left",type:"text",name:"tmplbl",value:actionEls.rowTxt}).addClass("first");actionEls.lockUnlock=new Element("span",{"class":"restrictedactns",title:jbVars.txtAdmOnlyQ,text:" "}).addEvent("click",function(c){c=new Event(c).stop();actionEls.restricted=actionEls.restricted==0?1:0;if(actionEls.restricted==0&&!this.hasClass("public")){this.addClass("public")}if(actionEls.restricted==1&&this.hasClass("public")){this.removeClass("public")}});actionEls.rowLbl.destroy();actionEls.lblInp.injectBefore(actionEls.edDiv.getFirst());if(actionEls.restricted==0){actionEls.lockUnlock.addClass("public")}actionEls.rowSave=new Element("a",{"class":"btn-grn save",text:jbVars.txtDone}).addEvent("click",function(c){c=new Event(c).stop();actionEls.rowTxt=actionEls.lblInp.value;actionEls.lblInp.destroy();if(actionEls.FieldTag=="span"||actionEls.FieldTag=="select"){}else{actionEls.descrSpan.destroy()}actionEls.newRowLbl=new Element("label",{"for":actionEls.rowNme,text:actionEls.rowTxt}).injectBefore(actionEls.edDiv.getFirst());if(actionEls.restricted==1){actionEls.newRowLbl.addClass("restricted")}switch(actionEls.FieldTag){case"input":actionEls.rowField.setAttribute("disabled",true);break;case"select":actionEls.rowField.removeEvents().setAttribute("disabled",true);actionEls.rowInput.removeEvents().destroy();actionEls.rowDefltBtn.removeEvents().destroy();actionEls.rowAddCirc.removeEvents().destroy();actionEls.rowDelCirc.removeEvents().destroy();actionEls.defaultOpt=null;actionEls.selVal=null;actionEls.selOpt=null;break;case"textarea":actionEls.rowField.setAttribute("disabled",true);break;case"span":if(actionEls.rowField.hasClass("checkbox")){actionEls.rowInput.removeEvents().setAttribute("disabled",true);actionEls.rowInput.removeClass("m2em");actionEls.rowField.set("text",actionEls.rowInputLabel.value);actionEls.rowInputLabel.destroy();actionEls.rowField.setStyle("display","inline")}if(actionEls.rowField.hasClass("radios")){actionEls.rowField.removeClass("r5px");actionEls.rowFields=actionEls.rowField.getElements("input[type=radio]");actionEls.rowFields.each(function(e){e.setAttribute("disabled",true);e.removeEvents();var f=e.getAttribute("value");var d=e.getParent("span.radio").getElement("input[type=text]");actionEls.rowLabels[f]=d.value;d.destroy();actionEls.newRadioLbl=new Element("label",{"for":actionEls.inputSafeName+"_"+e.value,text:actionEls.rowLabels[f]}).injectBefore(e)});actionEls.rowLabels=null;actionEls.rowAddCirc.removeEvents().destroy();actionEls.rowDelCirc.removeEvents().destroy()}if(actionEls.rowField.hasClass("datelbl")){if(actionEls.showMonth==0){actionEls.dateRowMonth.addClass("displnone");actionEls.dateFieldLbls[1].addClass("displnone");actionEls.showDay==0}if(actionEls.showDay==0){actionEls.dateRowDay.addClass("displnone");actionEls.dateFieldLbls[2].addClass("displnone")}actionEls.dateRowDayCb.removeEvents().destroy();actionEls.dateRowMonthCb.removeEvents().destroy();actionEls.dateRowDay.setAttribute("disabled","disabled");actionEls.dateRowMonth.setAttribute("disabled","disabled");actionEls.dateRowYr.value=actionEls.dateRowYr.value.trim();actionEls.dateRowYr.setAttribute("disabled","disabled")}break}actionEls.lockUnlock.removeEvents().destroy();actionEls.edDiv.removeClass("qrowed");contQ.getElements("div.qrow").each(function(d){d.removeClass("qrowedmode")});submitBtn.removeAttribute("disabled");edPaneSlide.slideIn("vertical");editInputs.removeClass("opacityPointFour");editInputs.getElements("input").each(function(d){d.removeAttribute("disabled")});editInputs.getElements("select").each(function(d){d.removeAttribute("disabled")});actionEls.rowSave.removeEvents().destroy();actionElsRowActnbtns.each(function(d){if(d.id==actionEls.edDiv.id){d.getElements("a").each(function(e){e.setStyle("display","inline-block")})}else{d.getElements("a").each(function(e){e.setStyle("visibility","visible")})}});actionElsRowActnbtns=null;qSorter=new Sortables(contQ,{opacity:0.3,constrain:true,transition:Fx.Transitions.Elastic.easeOut,duration:450,revert:{duration:450,transition:"elastic:out"},onComplete:recalcElements});recalcElements();actionEls=null}).injectAfter(actionEls.edDiv.getFirst());actionEls.lockUnlock.injectBefore(actionEls.rowSave)}})})};var setDelActns=function(){$$("a.del").each(function(a){a.addEvents({click:function(c){c=new Event(c).stop();var f=this.getParent().getLast();var b=f.tagName.toLowerCase();var d;if(b=="span"){if(f.hasClass("checkbox")){d=f.getParent("div.qrow").getElement("input[type=checkbox]").name}if(f.hasClass("radios")){d=f.getFirst("span.radio").getElement("input[type=radio]").name}}else{d=f.name}document.qForm.elements.task.value="delqrow";document.qForm.elements.name.value=d;document.qForm.submit()}})})};var replaceSpace=function(a){if(a==" "||a=="&nbsp;"){return"_"}else{return""}};var recalcElements=function(){var d=$$("div.qrow");var j=d.length;var n,u,v;QuestionnaireData.fields=[];var w={};if(j>0){for(row=0;row<j;row++){n=d[row];var o=n.getFirst("label");u=o.get("text");v=n.getLast();var c=!o.hasClass("restricted")?0:1;var b=v.tagName.toLowerCase();var e,k;if(b!="span"){k=v.getAttribute("name").trim()}if(b=="input"){b=v.getAttribute("type").trim();switch(b){case"checkbox":break;case"text":e=v.value.trim();default:break}}if(b=="textarea"){e=v.value.trim()}if(b=="select"){var p;e={};var t={};var i=[];e.defaultOpt=1;v.getElements("option").each(function(x){t={};t.value=x.getAttribute("value");t.label=x.text;i.push(t);if(!x.getAttribute("selected")){}else{e.defaultOpt=t.value}});e.multiple=!v.getAttribute("multiple")?0:1;e.options=i;t=null}if(b=="span"&&v.hasClass("checkbox")){e={};var s=v.getParent("div.qrow").getElement("input[type=checkbox]");e.value=!s.getAttribute("checked")?0:1;e.label=v.get("text");k=s.getAttribute("name").trim();b="checkbox"}if(b=="span"&&v.hasClass("radios")){var h;e={};var a={};var r=[];e.defaultOpt=1;v.getElements("input[type=radio]").each(function(x){a={};a.value=x.getAttribute("value");a.label=x.getParent("span").getElement("label").get("text");a.id=x.id;r.push(a);if(!x.getAttribute("checked")){}else{e.defaultOpt=a.value}});b="radio";e.options=r;k=v.getFirst("span.radio").getElement("input[type=radio]").getAttribute("name");a=null}if(b=="span"&&v.hasClass("datelbl")){e={};var f=v.getParent("div.qrow");var q=f.getElements("input[type=text]");var l=f.getElement("select");k=l.name.replace("[month]","").trim();var g=q[1];e.showDay=g.hasClass("displnone")?0:1;e.showMonth=l.hasClass("displnone")?0:1;e.defaultDay=g.value;e.defaultMonth=l.value;e.defaultYear=q[0].value;b="date";f=null;g=null;dateRowMonth=null}w={name:k,label:u,deflt:e,type:b,restricted:c};QuestionnaireData.fields.push(w)}QuestionnaireJson=JSON.encode(QuestionnaireData);document.qForm.elements.fields.value=QuestionnaireJson}else{qSorter.detach();qSorter=null;document.qForm.elements.title.value=$("title_0").value;document.qForm.elements.description.value=$("description_0").value;document.qForm.elements.name.value=cleanString(document.qForm.elements.title.value)}};var setEditPane=function(d,o){var x=d.getElement("span[class=cont]");newFieldDefaults={};newFieldDefaults.restricted=0;newFieldDefaults.type=o;x.set("html","");var f=new Element("input",{type:"checkbox",name:"admins_only",id:"admins_only",value:"yes"});var c=new Element("label",{"class":"l15","for":"admins_only",text:jbVars.txtAdmOnly});edPaneSlide.slideOut("vertical");var k=38;if(o!="select"||o!="radio"){defaultsPane.getElements("input[type=text]").each(function(G){G.value=""})}switch(o){case"checkbox":var w=new Element("label",{"for":"default_val",text:jbVars.txtSubLbl});var v=new Element("select",{name:"default_val",id:"default_val"}).addEvent("change",function(){newFieldDefaults.deflt.value=this.value});var q=new Element("option",{text:jbVars.txtUnhecked,value:"0"}).injectInside(v);var p=new Element("option",{text:jbVars.txtChecked,value:"1"}).injectAfter(q);var F=new Element("input",{type:"text",name:"default_val_lbl",id:"default_val_lbl",value:""}).addEvent("keyup",function(){newFieldDefaults.deflt.label=this.value});newFieldDefaults.deflt={};newFieldDefaults.deflt.value=0;newFieldDefaults.deflt.label="";break;case"radio":k=64;var E=new Element("span",{"class":"radios",id:"default_radios"});var b=jbVars.txtOption+" 1";var a=cleanString(b);var A=new Element("span",{"class":"radio"}).injectInside(E);var z=new Element("input",{type:"radio","class":"right",name:"radio_value",id:a,checked:"checked",disabled:"disabled",alt:b,value:"1"}).injectInside(A);var h=new Element("label",{"for":a,text:b}).injectBefore(z);var v=new Element("select",{"class":"selopts",name:"default_val",id:"default_val"});var q=new Element("option",{selected:"selected",text:jbVars.txtOption+" 1",value:"1"}).injectInside(v);var r=new Element("span",{"class":"add",text:" "});var C=new Element("span",{"class":"cremove",text:" "});var e=new Element("span",{id:"odefault","class":"sdefault",text:" "}).addClass("selected");var D=new Element("input",{type:"text",name:"opt_val",id:"opt_val",value:jbVars.txtOption+" 1"});newFieldDefaults.deflt={};break;case"text":var w=new Element("label",{"for":"default_val",text:jbVars.defVal});var v=new Element("input",{type:"text",name:"default_val",id:"default_val",value:""}).addEvents({keyup:function(){newFieldDefaults.deflt=this.value},blur:function(){newFieldDefaults.deflt=this.value}});var n=new Element("input",{type:"checkbox",name:"required",id:"required",value:"yes"});var i=new Element("label",{"class":"l15","for":"required",text:jbVars.txtReqd}).injectBefore(n);newFieldDefaults.deflt="";break;case"textarea":var w=new Element("label",{"for":"default_val",text:jbVars.defVal});var v=new Element("input",{type:"text",name:"default_val",id:"default_val",value:""}).addEvents({keyup:function(){newFieldDefaults.deflt=this.value},blur:function(){newFieldDefaults.deflt=this.value}});var n=new Element("input",{type:"checkbox",name:"required",id:"required",value:"yes"});var i=new Element("label",{"class":"l15","for":"required",text:jbVars.txtReqd}).injectBefore(n);newFieldDefaults.deflt=0;break;case"select":var v=new Element("select",{"class":"selopts",name:"default_val",id:"default_val"});var q=new Element("option",{selected:"selected",text:jbVars.txtOption+" 1",value:"1"}).injectInside(v);var r=new Element("span",{"class":"add",text:" "});var C=new Element("span",{"class":"cremove",text:" "});var e=new Element("span",{id:"odefault","class":"sdefault",text:" "}).addClass("selected");var D=new Element("input",{type:"text",name:"opt_val",id:"opt_val",value:jbVars.txtOption+" 1"});var t=new Element("input",{type:"checkbox",name:"multiple",id:"multiple",value:"yes"}).addEvent("click",function(){newFieldDefaults.deflt.multiple=(newFieldDefaults.deflt.multiple==0)?1:0});var s=new Element("label",{"class":"l15","for":"admins_only",text:jbVars.txtMulti});newFieldDefaults.deflt={};break;case"date":var y=new Element("input",{type:"text",size:3,name:"default_day",value:parseInt(jbVars.currDay)<9?"0"+jbVars.currDay:jbVars.currDay}).addEvents({keypress:function(G){if(this.hasClass("error")){this.removeClass("error")}this.value=this.value.replace(".","");if((G.code==8||G.code==46)){}else{if(G.code<48||G.code>57||this.value.length>=2){G=new Event(G).stop();this.addClass("error")}}},keyup:function(){newFieldDefaults.deflt.defaultDay=this.value},blur:function(){newFieldDefaults.deflt.defaultDay=this.value}});var l=new Element("select",{name:"default_month"}).addEvent("change",function(){newFieldDefaults.deflt.defaultMonth=this.value});var B=parseInt(jbVars.currMonth);for(m=0;m<12;m++){var g=m+1;var j=m<9?"0"+g:g;var u=new Element("option",{text:jbVars.months[m],value:j});if(g==B){u.setAttribute("selected","selected")}u.injectInside(l)}var v=new Element("input",{size:4,type:"text",name:"default_year",id:"default_year",value:jbVars.currYear}).addEvents({keypress:function(G){if((G.code==8||G.code==46)){}else{if(G.code<48||G.code>57||this.value.length>=4){G=new Event(G).stop()}}},keyup:function(G){newFieldDefaults.deflt.defaultYear=this.value},blur:function(){newFieldDefaults.deflt.defaultYear=this.value}});var n=new Element("input",{type:"checkbox",name:"required",id:"required",value:"yes"});var i=new Element("label",{"class":"l15","for":"required",text:jbVars.txtReqd}).injectBefore(n);var w=new Element("label",{"for":"default_val",text:jbVars.txtIncl+":"});newFieldDefaults.deflt={};break}edPaneSlide.chain(function(){d.setStyle("height",k+"px");d.getElement("span[class=hdr]").set("html",jbVars.fieldType+" : "+o+" | ");v.injectInside(x);if(o=="select"||o=="radio"){}else{w.injectBefore(v)}if(o=="checkbox"){F.injectBefore(v)}f.injectAfter(v).addEvent("click",function(){newFieldDefaults.restricted=(this.checked==true)?1:0});c.injectBefore(f);if(o=="date"){newFieldDefaults.deflt.showDay=1;newFieldDefaults.deflt.showMonth=1;newFieldDefaults.deflt.defaultDay=jbVars.currDay;newFieldDefaults.deflt.defaultMonth=jbVars.currMonth;newFieldDefaults.deflt.defaultYear=jbVars.currYear;y.injectBefore(v);l.injectAfter(y);var K=new Element("input",{"class":"subinput",type:"checkbox",name:"show_day",value:"yes"}).addEvent("click",function(){if(newFieldDefaults.deflt.showDay==0){newFieldDefaults.deflt.showDay=1;y.removeAttribute("disabled");K.setAttribute("checked","checked");if(!Q.hasAttribute("checked")&&l.hasAttribute("disabled")){Q.setAttribute("checked","checked");Q.checked=true;l.removeAttribute("disabled");newFieldDefaults.deflt.showMonth=1}}else{newFieldDefaults.deflt.showDay=0;y.setAttribute("disabled","disabled");K.removeAttribute("checked")}}).injectBefore(l);K.setAttribute("checked","checked");var P=new Element("span",{"class":"checkbox",text:jbVars.txtInclday}).injectBefore(y);var Q=new Element("input",{"class":"subinput",type:"checkbox",name:"show_month",value:"yes"}).addEvent("click",function(){if(newFieldDefaults.deflt.showMonth==0){newFieldDefaults.deflt.showMonth=1;l.removeAttribute("disabled");Q.setAttribute("checked","checked")}else{newFieldDefaults.deflt.showMonth=0;l.setAttribute("disabled","disabled");newFieldDefaults.deflt.showDay=0;Q.removeAttribute("checked");if(K.hasAttribute("checked")&&!y.hasAttribute("disabled")){K.removeAttribute("checked");K.checked=false;y.setAttribute("disabled","disabled");newFieldDefaults.deflt.showDay=0}}}).injectBefore(v);Q.setAttribute("checked","checked");var M=new Element("span",{"class":"checkbox",text:jbVars.txtInclmonth}).injectBefore(l);var O=new Element("span",{"class":"checkbox",text:jbVars.txtYear}).injectBefore(v)}if(o=="select"){newFieldDefaults.deflt.defaultOpt=1;newFieldDefaults.deflt.multiple=0;var I=[];var G={value:newFieldDefaults.deflt.defaultOpt,label:jbVars.txtOption+" 1"};I.push(G);newFieldDefaults.deflt.options=I;var L=x.getElement("select[id=default_val]");var J=L.getElement("option[value="+L.value+"]");L.addEvent("change",function(U){U=new Event(U).stop();var T=x.getElement("input[id=opt_val]");J=L.getElement("option[value="+L.value+"]");T.value=J.text;if(newFieldDefaults.deflt.defaultOpt==L.value){var S=x.getElement("span[id=odefault]");S.addClass("selected")}else{var S=x.getElement("span[id=odefault]");S.removeClass("selected")}});r.addEvent("click",function(W){W=new Event(W).stop();J.removeAttribute("selected");var aa=x.getElement("input[id=opt_val]");var U=L.getLast("option");var S=parseInt(U.value)+1;var V=jbVars.txtOption+" "+S;var T=new Element("option",{selected:"selected",text:V,value:S}).injectInside(L);aa.value=V;G={value:S,label:V};newFieldDefaults.deflt.options[S]=G;var X=x.getElement("span[id=odefault]");X.removeClass("selected");var Y=x.getElement("span[class=cremove]");var Z=L.getElements("option").length;if(Z==1){Y.setStyle("visibility","hidden")}if(Z>1){Y.setStyle("visibility","visible")}}).injectBefore(c);D.addEvents({keyup:function(S){S=new Event(S).stop();J=L.getElement("option[value="+L.value+"]");J.text=this.value;newFieldDefaults.deflt.options[L.value].label=this.value},blur:function(S){S=new Event(S).stop();J=L.getElement("option[value="+L.value+"]");J.text=this.value;newFieldDefaults.deflt.options[L.value].label=this.value}}).injectBefore(r);C.addEvents({load:function(S){S=new Event(S).stop();var T=L.getElements("option").length;if(T==1){S.setStyle("visibility","hidden")}},click:function(U){U=new Event(U).stop();var T=L.getElements("option").length;if(T==1){this.setStyle("visibility","hidden");return}var S=x.getElement("input[id=opt_val]");J=L.getElement("option[value="+L.value+"]");newFieldDefaults.deflt.options[L.value]=null;J.destroy();J=L.getElement("option[value="+L.value+"]");S.value=J.text}}).injectAfter(r);e.addEvent("click",function(T){T=new Event(T).stop();newFieldDefaults.deflt.defaultOpt=L.value;var S=x.getElement("span[id=odefault]");S.addClass("selected")}).injectAfter(v);t.injectBefore(c);s.injectBefore(t)}if(o=="radio"){newFieldDefaults.deflt.defaultOpt=1;var I=[];var G={value:newFieldDefaults.deflt.defaultOpt,label:jbVars.txtOption+" 1",id:cleanString(jbVars.txtOption+" 1")};I.push(G);newFieldDefaults.deflt.options=I;var L=x.getElement("select[id=default_val]");var J=L.getElement("option[value="+L.value+"]");var R=E.getElement("input[value="+L.value+"]");var H=R.getParent("span").getElement("label");var N=E.getElements("input[type=radio]");L.addEvent("change",function(U){U=new Event(U).stop();var T=x.getElement("input[id=opt_val]");J=L.getElement("option[value="+L.value+"]");N=E.getElements("input[type=radio]");N.each(function(V){V.removeAttribute("defaultchecked");V.removeAttribute("checked")});R=E.getElement("input[value="+L.value+"]");R.set("checked","checked");T.value=J.text;if(newFieldDefaults.deflt.defaultOpt==L.value){var S=x.getElement("span[id=odefault]");S.addClass("selected")}else{var S=x.getElement("span[id=odefault]");S.removeClass("selected")}});r.addEvent("click",function(aa){aa=new Event(aa).stop();J.removeAttribute("selected");var ag=x.getElement("input[id=opt_val]");var V=L.getLast("option");var S=parseInt(V.value)+1;var X=jbVars.txtOption+" "+S;var U=new Element("option",{selected:"selected",text:X,value:S}).injectInside(L);ag.value=X;var ab=x.getElement("span[id=odefault]");ab.removeClass("selected");var ae=x.getElement("span[class=cremove]");var af=L.getElements("option").length;if(af==1){ae.setStyle("visibility","hidden")}if(af>1){ae.setStyle("visibility","visible")}N=E.getElements("input[type=radio]");N.each(function(ah){ah.removeAttribute("defaultchecked");ah.removeAttribute("checked")});var Y=X;var T=cleanString(X);var ad=new Element("span",{"class":"radio"});var ac=new Element("input",{type:"radio","class":"right",name:"radio_value",checked:"checked",disabled:"disabled",id:T,alt:Y,value:S}).injectInside(ad);var W=new Element("label",{"for":T,text:Y}).injectBefore(ac);var Z=parseInt(E.getFirst("span.radio").getStyle("height").replace("px",""));k+=Z+5;d.setStyle("height",k+"px");edPaneSlide.slideIn("vertical").chain(function(){ad.injectInside(E)});G={value:S,label:X,id:T};newFieldDefaults.deflt.options[S]=G}).injectBefore(c);D.addEvents({keyup:function(S){S=new Event(S).stop();J=L.getElement("option[value="+L.value+"]");R=E.getElement("input[value="+L.value+"]");H=R.getParent("span").getElement("label");J.text=this.value;H.set("text",this.value);newFieldDefaults.deflt.options[L.value].label=this.value},blur:function(S){S=new Event(S).stop();J=L.getElement("option[value="+L.value+"]");R=E.getElement("input[value="+L.value+"]");H=R.getParent("span").getElement("label");J.text=this.value;H.set("text",this.value);newFieldDefaults.deflt.options[L.value].label=this.value}}).injectBefore(r);C.addEvents({load:function(S){S=new Event(S).stop();var T=L.getElements("option").length;if(T==1){S.setStyle("visibility","hidden")}},click:function(){var U=L.getElements("option").length;if(U==1){this.setStyle("visibility","hidden");return}var S=x.getElement("input[id=opt_val]");J=L.getElement("option[value="+L.value+"]");R=E.getElement("input[value="+L.value+"]");newFieldDefaults.deflt.options[L.value]=null;J.destroy();var T=parseInt(E.getFirst("span.radio").getStyle("height").replace("px",""));k-=T+5;d.setStyle("height",k+"px");edPaneSlide.slideIn("vertical").chain(function(){R.getParent("span").destroy();N=E.getElements("input[type=radio]");N.each(function(V){V.removeAttribute("defaultchecked");V.removeAttribute("checked")});R=E.getElement("input[value="+L.value+"]");R.set("checked","checked")});J=L.getElement("option[value="+L.value+"]");S.value=J.text}}).injectAfter(r);e.addEvent("click",function(T){T=new Event(T).stop();newFieldDefaults.deflt.defaultOpt=L.value;var S=x.getElement("span[id=odefault]");S.addClass("selected")}).injectAfter(v);E.injectInside(defaultsPane)}this.slideIn("vertical")})};var addRow=function(f,n){if(f.type=="date"){if(parseInt(f.deflt.defaultDay)>31){return defaultsPane.getElement("input[name=default_day]").addClass("error").focus()}if(parseInt(f.deflt.defaultMonth)==2&&f.deflt.defaultDay>28){defaultsPane.getElement("input[name=default_day]").addClass("error").focus();defaultsPane.getElement("select[name=default_month]").addEvent("click",function(){if(this.hasClass("error")){this.removeClass("error")}}).addClass("error");return}}if(qSorter!=null){qSorter.detach()}qSorter=null;var o;switch(f.type){case"checkbox":if(f.deflt.value==1){o=new Element("input",{type:"checkbox",name:f.name,id:f.name,value:"yes",disabled:"disabled",checked:"checked"})}else{if(f.deflt.value==0){o=new Element("input",{type:"checkbox",name:f.name,id:f.name,disabled:"disabled",value:"yes"})}}elLbl=new Element("span",{"class":"checkbox",text:f.deflt.label});break;case"radio":Array.prototype.clean=function(){for(var u=0;u<this.length;u++){if(this[u]==null){this.splice(u,1);u--}}return this};f.deflt.options.clean();o=new Element("span",{"class":"radios"});var j;var l=0;f.deflt.options.each(function(w){l+=1;var x=new Element("span",{"class":"radio"}).injectInside(o);var u=new Element("label",{"for":f.name+"_"+l,text:w.label}).injectInside(x);var v=(w.value==f.deflt.defaultOpt)?true:false;if(w!=null){if(v==true){j=new Element("input",{type:"radio",name:f.name,disabled:"disabled",id:f.name+"_"+l,value:l,checked:"checked"}).injectInside(x)}else{j=new Element("input",{type:"radio",disabled:"disabled",name:f.name,id:f.name+"_"+l,value:l}).injectInside(x)}}});j=null;break;case"text":o=new Element("input",{type:"text",name:f.name,id:f.name,disabled:"disabled",value:f.deflt});break;case"textarea":o=new Element("textarea",{name:f.name,id:f.name,rows:1,disabled:"disabled",value:f.deflt});break;case"select":Array.prototype.clean=function(){for(var u=0;u<this.length;u++){if(this[u]==null){this.splice(u,1);u--}}return this};f.deflt.options.clean();if(f.deflt.multiple==1){o=new Element("select",{name:f.name,multiple:"multiple",disabled:"disabled",id:f.name})}else{o=new Element("select",{name:f.name,disabled:"disabled",id:f.name})}var j;if(f.deflt.multiple==1){var i=1}f.deflt.options.each(function(v){var u=(v.value==f.deflt.defaultOpt)?true:false;if(v!=null){j=new Element("option",{text:v.label,value:v.value});if(u==true){j.setAttribute("selected","selected")}if(f.deflt.multiple==1){i+=1}}j.injectInside(o)});j=null;break;case"date":var b=new Element("input",{size:4,type:"text",name:f.name+"[year]",disabled:"disabled",value:f.deflt.defaultYear}).addEvent("keypress",function(u){if((u.code==8||u.code==46)){}else{if(u.code<48||u.code>57||this.value.length>=4){u=new Event(u).stop()}}});var t=new Element("select",{name:f.name+"[month]",disabled:"disabled"});var p=parseInt(f.deflt.defaultMonth);for(m=0;m<12;m++){var c=m+1;var e=m<9?"0"+c:c;var h=new Element("option",{text:jbVars.months[m],value:e});if(c==p){h.setAttribute("selected","selected")}h.injectInside(t)}var o=new Element("input",{type:"text",size:3,disabled:"disabled",name:f.name+"[day]",value:f.deflt.defaultDay}).addEvent("keypress",function(u){if((u.code==8||u.code==46)){}else{if(u.code<48||u.code>57||this.value.length>=2){u=new Event(u).stop()}}});break}var k=new Element("a",{"class":"del",href:"#",title:jbVars.txtDel}).addEvent("click",function(u){u=new Event(u).stop();this.getParent("div").destroy();recalcElements()});var r=new Element("a",{"class":"ed",href:"#",title:jbVars.txtEdit});var q=new Element("div",{id:"qrow-"+n,"class":"qrow"});var s=new Element("label",{"for":f.name}).set("text",f.label).injectInside(q);if(f.restricted==1){s.addClass("restricted")}k.injectInside(q);r.injectInside(q);o.injectInside(q);if(f.type=="radio"){q.setStyle("min-height",21*l)}if(f.type=="checkbox"){elLbl.injectAfter(o)}if(f.type=="select"){if(f.deflt.multiple==1){q.setStyle("min-height",18*i)}}if(f.type=="date"){b.injectBefore(o);t.injectAfter(b);var d=new Element("span",{"class":"datelbl",text:jbVars.txtInclday}).injectAfter(o);var a=new Element("span",{"class":"datelbl",text:jbVars.txtInclmonth}).injectAfter(t);var g=new Element("span",{"class":"datelbl",text:jbVars.txtYear}).injectAfter(b);if(f.deflt.showDay==0){d.addClass("displnone");o.addClass("displnone")}if(f.deflt.showMonth==0){a.addClass("displnone");t.addClass("displnone")}}editInputs.getElements("input[type=text]").each(function(u){u.value=""});editInputs.getElement("span[id=fnametxt]").set("text","");q.injectInside(contQ);setActionElements();QuestionnaireData.fields.push(f);QuestionnaireJson=JSON.encode(QuestionnaireData);document.qForm.elements.fields.value=QuestionnaireJson;QuestionnaireJson=null;qSorter=new Sortables(contQ,{opacity:0.3,constrain:true,transition:Fx.Transitions.Elastic.easeOut,duration:450,revert:{duration:450,transition:"elastic:out"},onComplete:recalcElements});windowScroll.toElement("fpanel","y").chain(function(){q.highlight("#FFFFBF")})};