
/**
  @package JobBoard
  @copyright Copyright (c)2010-2013 Figomago <http://figomago.wordpress.com>
  @license : GNU General Public License v3 or later
----------------------------------------------------------------------- */

var lastEdNum;var lastEmplNum;var winScroll;var edRowContent="";var emplRowContent="";var skillrow=[];var yearOptions="";var monthOptions="";var countryOptions="";var edLevelOptions="";var startYearOptions='<option selected="selected" value="-1">--</option>\n';var endYearOptions;var edYearOptions='<option selected="selected" value="-1">--</option>\n';Element.extend({fade:function(d,c,b,a){new Fx.Style(this,"opacity",{duration:b,onComplete:function(){if(a){this.element.remove()}}}).start(d,c)}});window.addEvent("domready",function(){winScroll=new Fx.Scroll(this,{wait:false,duration:300,transition:Fx.Transitions.Quart.easeInOut});endYearOptions='<option selected="selected" value="-1">--</option>\n<option value="9999">'+jbVars.txtPresent+"</option>\n";for(var d in jbVars.countries){if(jbVars.countries[d].id!=null||jbVars.countries[d].id!=undefined){if(jbVars.countries[d].id==jbVars.defaultCountry){countryOptions+='<option value="'+jbVars.countries[d].id+'" selected="selected">'+jbVars.countries[d].name+"</option>\n"}else{countryOptions+='<option value="'+jbVars.countries[d].id+'">'+jbVars.countries[d].name+"</option>\n"}}}for(var b in jbVars.edLevels){if(jbVars.edLevels[b].id!=null||jbVars.edLevels[b].id!=undefined){edLevelOptions+='<option value="'+jbVars.edLevels[b].id+'">'+jbVars.edLevels[b].name+"</option>\n"}}for(m=0;m<12;m++){var a=jbVars.months[m];var c=m<9?"0"+(m+1):m+1;monthOptions+='<option value="'+c+'">'+a+"</option>\n"}for(y=0;y<41;y++){var f=jbVars.currYear-y;edYearOptions+='<option value="'+f+'">'+f+"</option>\n";startYearOptions+='<option value="'+f+'">'+f+"</option>\n";endYearOptions+='<option value="'+f+'">'+f+"</option>\n"}if($("newed")){$("newed").addEvent("click",function(o){o=new Event(o).stop();if(jbVars.qualNum==(jbVars.maxQuals-1)){$("newed").setStyle("visibility","hidden")}if(jbVars.qualNum>(jbVars.maxQuals-1)){return}lastEdNum=jbVars.qualNum;jbVars.qualNum+=1;var g="";if(jbVars.qualNum>1){g='<a class="btn">'+jbVars.txtRemove+"</a>"}edRowContent='<span class="qualheading">'+jbVars.txtEdu+" "+jbVars.qualNum+g+"</span><label>"+jbVars.txtType+'</label><select name="edtype['+jbVars.qualNum+']">'+edLevelOptions+" </select><label>"+jbVars.txtQualname+'</label><input type="text" name="qual_name['+jbVars.qualNum+']" size="40" value="" /><label>'+jbVars.txtSchoolname+'</label><input type="text" name="school_name['+jbVars.qualNum+']" size="40" value="" /><label>'+jbVars.txtCountry+'</label><select name="edu_country['+jbVars.qualNum+']">'+countryOptions+"</select><label>"+jbVars.txtCity+'</label><input type="text" name="ed_location['+jbVars.qualNum+']" size="40"  value="" /><label>'+jbVars.txtQualyr+'</label><select class="infoRight" name="ed_year['+jbVars.qualNum+']">'+edYearOptions+"</select>";var j="edRow["+lastEdNum+"]";var i=$$("div.qualrow");var k=i[i.length-1];var p=k.getPosition().y;var h=k.getSize().y;var n=new Element("div",{id:"edRow-"+jbVars.qualNum,name:"edRow["+jbVars.qualNum+"]","class":"qualrow"}).set("html",edRowContent).injectAfter(k).set("opacity",0.3);winScroll.start(0,p+h).chain(function(){n.set("opacity",1)});var l=n.getElement('span[class="qualheading"]');l.getElement("a").addEvents({mousedown:function(){o=new Event(o).stop();this.getParent("div").set("opacity",0.6)},mouseup:function(q){q=new Event(q).stop();this.getParent("div").set("opacity",1)},click:function(q){q=new Event(q).stop();this.getParent("div").destroy();jbVars.qualNum--;winScroll.toElement(k);checkNumRows(true,"ed")}});checkNumRows(false,"ed")})}if($("newemp")){$("newemp").addEvent("click",function(j){j=new Event(j).stop();if(jbVars.emplNum==(jbVars.maxEmployers-1)){$("newemp").setStyle("visibility","hidden")}if(jbVars.emplNum>(jbVars.maxEmployers-1)){return}lastEmplNum=jbVars.emplNum;jbVars.emplNum+=1;var o="";if(jbVars.emplNum>0){o='<a class="btn">'+jbVars.txtRemove+"</a>"}emplRowContent='<span class="emplheading">'+jbVars.txtEmployer+" "+jbVars.emplNum+o+"</span><label>"+jbVars.txtCompany+'</label><input size="40" name="company['+jbVars.emplNum+']" type="text" value="" /><label>'+jbVars.txtJobtitle+'</label><input size="40" name="job_title['+jbVars.emplNum+']" type="text" value="" /><label>'+jbVars.txtCountry+'</label><select name="employer_country['+jbVars.emplNum+']">'+countryOptions+"</select><label>"+jbVars.txtCity+'</label><input size="40" name="employer_city['+jbVars.emplNum+']" type="text" value="" /><select name="startyear['+jbVars.emplNum+']" class="infoRight first" tabindex="911">'+endYearOptions+'</select><select name="endmon['+jbVars.emplNum+']">'+monthOptions+'</select><label class="rightlabel">'+jbVars.txtEndyr+'</label><select name="endyear['+jbVars.emplNum+']" class="infoRight" tabindex="912">'+startYearOptions+'</select><select name="startmon['+jbVars.emplNum+']">'+monthOptions+'</select><label class="label required rightlabel first">'+jbVars.txtStartyr+'</label><span class="chk_wrapper">'+jbVars.txtEmplCurr+'<input class="chk_empl" type="checkbox" name="empl_iscurrent['+jbVars.emplNum+']" value="0" /></span>';var p="employer["+lastEmplNum+"]";var n=$$("div.emplrow");var h=n[n.length-1];var g=h.getPosition().y;var k=h.getSize().y;console.log("injecting new: employer-"+jbVars.emplNum);var i=new Element("div",{id:"employer-"+jbVars.emplNum,name:"employer["+jbVars.emplNum+"]","class":"emplrow"}).set("html",emplRowContent).injectAfter(h).set("opacity",0.3);var l=i.getElement('span[class="emplheading"]');console.log("getting span: "+l.get("text"));l.getElement("a").addEvents({mousedown:function(){j=new Event(j).stop();this.getParent("div").set("opacity",0.6)},mouseup:function(q){q=new Event(q).stop();this.getParent("div").set("opacity",1)},click:function(q){q=new Event(q).stop();this.getParent("div").destroy();jbVars.emplNum--;winScroll.toElement(h);checkNumRows(true,"em")}});winScroll.start(0,g+k).chain(function(){i.set("opacity",1)});checkNumRows(false,"em")})}});var checkNumRows=function(f,c){var h=c=="ed"?$$("div.qualrow"):$$("div.emplrow");var b=h.length;var a=c=="ed"?jbVars.maxQuals:jbVars.maxEmployers;if(b<a){if(c=="ed"){$("newed").setStyle("visibility","visible")}if(c=="em"){$("newemp").setStyle("visibility","visible")}}if(c=="ed"){$("quals_count").setAttribute("value",b)}if(c=="em"){$("employer_count").setAttribute("value",b)}if(f==false){if(b==1||b<2){return}else{var d;var g;for(es=2;es<b;es++){d=c=="ed"?h[es-1].getElement('span[class="qualheading"]'):h[es-1].getElement('span[class="emplheading"]');g=d.getElement("a");if(es<b){g.setStyle("visibility","hidden");g.removeEvent("click");if(c=="ed"){$("quals_count").setAttribute("value",b)}if(c=="em"){$("employer_count").setAttribute("value",b)}}else{g.setStyle("visibility","visible");g.addEvents({mousedown:function(){e=new Event(e).stop();this.getParent("div").set("opacity",0.6)},mouseup:function(i){i=new Event(i).stop();this.getParent("div").set("opacity",1)},click:function(i){i=new Event(i).stop();this.getParent("div").destroy()}});if(c=="ed"){$("quals_count").setAttribute("value",b)}if(c=="em"){$("employer_count").setAttribute("value",b)}}}}}else{var d;var g;d=c=="ed"?h[b-1].getElement('span[class="qualheading"]'):h[b-1].getElement('span[class="emplheading"]');if(!d){return}g=d.getElement("a");if(es<b){g.setStyle("visibility","hidden");g.removeEvent("click");if(c=="ed"){$("quals_count").setAttribute("value",b)}if(c=="em"){$("employer_count").setAttribute("value",b)}}else{g.setStyle("visibility","visible");g.addEvents({mousedown:function(i){i=new Event(i).stop();this.getParent("div").set("opacity",0.6)},mouseup:function(i){i=new Event(i).stop();this.getParent("div").set("opacity",1)},click:function(i){i=new Event(i).stop();this.getParent("div").destroy()}});if(c=="ed"){$("quals_count").setAttribute("value",b)}if(c=="em"){$("employer_count").setAttribute("value",b)}}}};var delEdu=function(b){var c=b.getParent("div");var a=c.getPrevious("div.qualrow");c.fade(1,0.3,600).destroy();jbVars.qualNum--;winScroll.toElement(a);checkNumRows(true,"ed")};var delEmployer=function(a){var b=a.getParent("div");var c=b.getPrevious("div.emplrow");b.fade(1,0.3,600).destroy();jbVars.emplNum--;winScroll.toElement(c);checkNumRows(true,"em")};