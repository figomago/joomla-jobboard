
/**
  @package JobBoard
  @copyright Copyright (c)2010-2013 Figomago <http://figomago.wordpress.com>
  @license : GNU General Public License v3 or later
----------------------------------------------------------------------- */

var TandolinCvSearch=new Class({Implements:[Options,Events],options:{searchBox:"cvsrcharea",searchFormName:"cvsrchForm",fieldsResetName:"f_reset",refineCont:"cvr-refine",toggleClass:"cv-ftoggle",toggleOpenClass:"open",loaderClassName:"loadr",resultsArea:"cvprofs",hiddenClassName:"hidden",edLinkClassName:"edfilter",singularClassName:"singular",firstContName:"job_title",toggleTransition:Fx.Transitions.Quart.easeOut,toggleDuration:500},initialize:function(a){this.setOptions(a);this.searchBox=$(this.options.searchBox);this.refineCont=$(this.options.refineCont);this.searchForm=$(this.options.searchFormName);this.searchInputs=this.searchBox.getElements("input[type=text]");this.resetTrigger=this.searchBox.getElement("a");this.loading=this.searchBox.getFirst("span");this.resultsArea=$(this.options.resultsArea);this.submitBtn=this.searchBox.getElement("input[type=submit]");this.sectionEffects=[];this.sectionsY=[];this.launch()},launch:function(){this.initialStateEmpty=this.inputsEmpty();if(!this.initialStateEmpty){this.showReset()}this.searchInputs.each(function(a){this.setInputListeners(a)}.bind(this));this.submitBtn.addEvent("click",function(a){a.stop();if(!this.inputsEmpty()){this.submitBtn.removeEvents().setAttribute("diabled","diabled");this.fadeView();this.loading.removeClass(this.options.hiddenClassName);this.searchForm.submit()}}.bind(this));if(this.refineCont){this.refineCont.getElements("span[class="+this.options.toggleClass+"]").each(function(b){b.addClass(this.options.toggleOpenClass);var a=b.id.split("-");this.initRefineToggle(a[0]);b.addEvent("click",function(d){d.stop();var c=b.hasClass(this.options.toggleOpenClass);if(c){this.toggleFilter(a[0],"c")}else{if(!c){this.toggleFilter(a[0],"o")}}b.toggleClass(this.options.toggleOpenClass)}.bind(this))}.bind(this))}},inputsEmpty:function(){var a=true;this.searchInputs.each(function(b){if(b.value.length!=0){a=false}});return a},setInputListeners:function(a){a.addEvents({focus:function(){this.checkInpStatus(a)}.bind(this),keyup:function(){this.checkInpStatus(a)}.bind(this),blur:function(){this.checkInpStatus(a)}.bind(this)})},checkInpStatus:function(b){var a=this.inputsEmpty();if(!a||b.value.length>0){this.showReset()}if(a){this.hideReset()}},showReset:function(){this.resetTrigger.removeClass(this.options.hiddenClassName);this.setTrigger()},hideReset:function(){this.resetTrigger.addClass(this.options.hiddenClassName).removeEvents()},setTrigger:function(){this.resetTrigger.addEvent("click",function(a){a.stop();this.clearInputs();this.hideReset();if(!this.initialStateEmpty){this.fadeView();this.loading.removeClass(this.options.hiddenClassName);this.searchForm.elements[this.options.fieldsResetName].value=1;this.searchForm.submit()}}.bind(this))},clearInputs:function(){this.searchInputs.each(function(a){a.value=""})},fadeView:function(){this.hideReset();this.searchInputs.each(function(a){a.setStyle("opacity",0.3)});this.resultsArea.setStyle("opacity",0.5)},initRefineToggle:function(a){var b=$(a+"-cont");this.sectionsY[a]=b.getSize().y;this.sectionEffects[a]=new Fx.Morph(a+"-cont",{transition:this.options.toggleTransition,duration:this.options.toggleDuration});var c=b.getElements("a");if(c.length!=0){c.each(function(d){d.addEvent("click",function(m){m.stop();var l=d.hasClass(this.options.edLinkClassName);var i=d.hasClass(a);if(!l&&!i){this.clearInputs();this.fadeView();this.loading.removeClass(this.options.hiddenClassName);this.searchForm.elements[a].value='"'+d.get("text")+'"';this.searchForm.submit()}else{if(l){var j=d.getAttribute("title").split("-");this.fadeView();this.searchForm.elements[a].value=j[1];this.searchForm.submit()}if(i){this.fadeView();var k=d.getParent("li").getElement("span").get("text");if(d.hasClass(this.options.singularClassName)){var g=this.refineCont.getFirst("ul"),h=g.id.split("-"),f=g.getFirst("li").getFirst("a");if(f){k=f.get("text");console.log(k);this.searchForm.elements[a].value="";this.searchForm.elements[h[0]].value=k}else{this.searchForm.elements[a].value=k}}this.searchForm.elements[a].value=k;this.searchForm.submit()}}}.bind(this))}.bind(this))}},toggleFilter:function(a,b){switch(b){case"c":this.sectionEffects[a].start({height:[this.sectionsY[a],0],opacity:[1,0]});break;case"o":this.sectionEffects[a].start({height:[0,this.sectionsY[a]],opacity:[0,1]});break;default:break}}});window.addEvent("domready",function(){var a=a||{};a.CvSearch=a.CvSearch||{};a.CvSearch.Instance=new TandolinCvSearch()});